{% load static %}
{% load mathfilters %}
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>pyBreak - {{ player.Name }} profile</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
        crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&family=Raleway:wght@200;300;400;600&display=swap" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
        <script src="{% static 'pyBreak/js/jquery-3.5.1.min.js' %}"></script>
        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
        <link href="{% static 'pyBreak/css/footable.bootstrap.css' %}" rel="stylesheet" type="text/css"/>
        <script src="{% static 'pyBreak/js/footable.js' %}" type="text/javascript"></script>
        <link rel="shortcut icon" href="#">       
    </head>

    <body>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark py-3 mb-5">
            <a href="#" class="navbar-brand">
              <h3 class="mb-0">pyBreak</h3>
            </a>
            <button class="navbar-toggler" data-toggle="collapse" data-target="#navbarSpy">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSpy">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a href="{% url 'players-stats' %}" class="nav-link" id="back-players">Back to other players</a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'index' %}" class="nav-link">Back to home</a>
                    </li>
                    <li class="nav-item">
                        <a href="#data-sources" class="nav-link">Analysis corner</a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'portfolio' %}" class="nav-link">Portfolio</a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <section id="choice-section" class="mt-3">
            <div id="criterias" class="d-flex row">
                <div class="col-12 col-lg-8 a">
                    <div id="choice-header" class="col-6 offset-3">PERIOD AND SURFACE SELECTION</div>
                    <div class="row jumbo-buttons d-flex align-items-center">
                        <div class="jumbo-bg">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <p class="text-center"><strong>You can filter the data by two criterias</strong></p>
                                    <p style="text-align:justify"><strong>Surface:</strong> possibility of selecting overall data without specifying the surface, or checking the players performance on specific court type - hard or clay.</p>
                                </div>
                                <div class="col-12 col-md-6">
                                    <p style="text-align:justify"><strong>Time period:</strong> dropdown button next to each of surface selection allows to choose if you want to see the data from whole database lifecycle (since start of 2019 ATP's season), only from the calendar year 2020, or since the ATP calendar was resumed after the COVID-19 lockdown.</p>
                                </div>
                            </div>
                            <div class="d-flex flex-column flex-xl-row-reverse" style="width: 100%; margin: auto;">
                                <div class="col-12 col-xl-6">
                                    <div class="row mb-3 m-xl-0">
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="d-flex flex-column align-items-center" style="margin: 0 auto;">
                                                    <div class="scenario" id="scenario-header">Current scenario:</div>
                                                    <div class="scenario" id="scenario-info">All surfaces, overall</div>
                                                </div>
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-xl-6">
                                    <div class="row m-0">
                                        <div class="col-4 p-0">
                                            <div class="btn-group special">
                                                <button type="button" class="btn btn-danger" id="btn-ovr">Summary</button>
                                                <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" id="btn-ovr-drop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Period selection</span>
                                                </button>
                                                <div class="dropdown-menu">
                                                <button class="dropdown-item" id="btn-ovr-ovr">Overall</button>
                                                <button class="dropdown-item" id="btn-ovr-year">Current year</button>
                                                <button class="dropdown-item" id="btn-ovr-cur">Post-lockdown</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4 pl-4">
                                            <div class="btn-group special">
                                                <button type="button" class="btn btn-info" id="btn-hard">Hard</button>
                                                <button type="button" class="btn btn-info dropdown-toggle dropdown-toggle-split" id="btn-hard-drop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Period selection</span>
                                                </button>
                                                <div class="dropdown-menu">
                                                <button class="dropdown-item" id="btn-hard-ovr">Overall</button>
                                                <button class="dropdown-item" id="btn-hard-year">Current year</button>
                                                <button class="dropdown-item" id="btn-hard-cur">Post-lockdown</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="btn-group special">
                                                <button type="button" class="btn btn-warning" id="btn-clay">Clay</button>
                                                <button type="button" class="btn btn-warning dropdown-toggle dropdown-toggle-split" id="btn-clay-drop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Period selection</span>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-left">
                                                <button class="dropdown-item" id="btn-clay-ovr">Overall</button>
                                                <button class="dropdown-item" id="btn-clay-year">Current year</button>
                                                <button class="dropdown-item" id="btn-clay-cur">Post-lockdown</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4 mt-4 mb-5 my-lg-0 b">
                    <div id="compare-div" class="col-6">PLAYERS COMPARISON</div>
                    <p class=" px-3 lead" style="margin-top: 30px;">You can choose the player to compare with {{ player.Name }} in filtered timespan and surface. After the choice, you can change the chosen player, time period and surface, or hide the comparison.</p>
                    <div class="d-flex flex-column align-items-center">
                        <button type="button" class="btn btn-danger my-2" id="del-test" style="display:none">Delete comparison</button>
                        <select class="js-example-basic-single form-control" id="selection">
                            <option></option>
                            {% for man in ovrobj %}
                            <option class="compare-option">#{{man.Rank}} {{ man.Name }}</a></option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="col-lg-6 mt-3 py-0 c">
                    <table class="table name-table">
                        <thead>
                            <tr>
                                <th>{{ player.Name }}</th>
                                <th style="display: flex; justify-content:center;">Rank: {{ player.Rank }}</th>
                            </tr>
                        </thead>
                    </table>

                    <table class="table footable data-table" id="primarytab">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Matches</th>
                                <th>Tiebreaks</th>
                                <th data-toggle="tooltip" data-placement="top" title="Player as the match favorite with odd less than 1.20">Surety odd</th>
                                <th data-toggle="tooltip" data-placement="top" title="Player as the match favorite with odd 1.20-1.50">Favorite odd</th>
                                <th data-toggle="tooltip" data-placement="top" title="Player as the match favorite with odd 1.50-1.80">Tipped odd</th>
                                <th data-toggle="tooltip" data-placement="top" title="Opponent as the match favorite with odd 1.50-1.80">Contender odd</th>
                                <th data-toggle="tooltip" data-placement="top" title="Opponent as the match favorite with odd 1.20-1.50">Outsider odd</th>
                                <th data-toggle="tooltip" data-placement="top" title="Opponent as the match favorite with odd less than 1.20">Underdog odd</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">Played</th>
                            <td>{{ player.Matches_played }}</td>
                            <td>{{ player.Tiebreak_played }}</td>
                            <td>{{ player.Surety_played }}</td>
                            <td>{{ player.Favorite_played }}</td>
                            <td>{{ player.Slightfav_played }}</td>
                            <td>{{ player.Slightunder_played }}</td>
                            <td>{{ player.Under_played }}</td>
                            <td>{{ player.Underdog_played }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Won</th>
                            <td>{{ player.Matches_won }}</td>
                            <td>{{ player.Tiebreak_won }}</td>
                            <td>{{ player.Surety_won }}</td>
                            <td>{{ player.Favorite_won }}</td>
                            <td>{{ player.Slightfav_won }}</td>
                            <td>{{ player.Slightunder_won }}</td>
                            <td>{{ player.Under_won }}</td>
                            <td>{{ player.Underdog_won }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Lost</th>
                            <td>{{ player.Matches_played|sub:player.Matches_won }}</td>
                            <td>{{ player.Tiebreak_played|sub:player.Tiebreak_won }}</td>
                            <td>{{ player.Surety_played|sub:player.Surety_won }}</td>
                            <td>{{ player.Favorite_played|sub:player.Favorite_won }}</td>
                            <td>{{ player.Slightfav_played|sub:player.Slightfav_won }}</td>
                            <td>{{ player.Slightunder_played|sub:player.Slightunder_won }}</td>
                            <td>{{ player.Under_played|sub:player.Under_won }}</td>
                            <td>{{ player.Underdog_played|sub:player.Underdog_won }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Win %</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="col-lg-6 mt-3 d">
                    <div id="comparedescdiv" style="display:none">
                        <table class="table name-table" id="comparedesc">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th style="display: flex; justify-content:center;"></th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div id="comparetabdiv" style="display:none">
                        <table class="table footable data-table" id="comparetab">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Matches</th>
                                    <th>Tiebreaks</th>
                                    <th>Surety odd</th>
                                    <th>Favorite odd</th>
                                    <th>Tipped odd</th>
                                    <th>Contender odd</th>
                                    <th>Outsider odd</th>
                                    <th>Underdog odd</th>
                                </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <th scope="row">Played</th>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="row">Won</th>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="row">Lost</th>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="row">Win %</th>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>  
                </div>
            </div>
        </section>


        <div class="container-fluid mt-3 mt-lg-2">

            <div class="row charts-order">
                <div class="col-md-6 col-xl-4">
                    <div class="header" id="spider-div" style="background-color: black; color: white" 
                        data-toggle="tooltip" data-placement="right" title="Skills spider shows the most important player's stats in terms of service and return
                        in graphic view. You can visually analyze the player's performance in various time period/surface scenario, and see the difference with the competitor selected for comparison as well.">SKILLS SPIDER</div>
                    <div class="jumbotron">
                        <canvas id="spider" height="100" width="150"></canvas>
                    </div>
                </div>
                <div class="col-md-6 col-xl-4">
                    <div class="header" id="serve-div" style="background-color: red; color: white"
                    data-toggle="tooltip" data-placement="right" title="Chart presents the performance in four serving areas: % accuracy of first serve shots in the 
                    court, % of points gained by first and second serve and accuracy of saving breakpoints in own service games.">SERVE STATS</div>
                    <div class="jumbotron">
                        <canvas id="servaccChart" height="100" width="150"></canvas> 
                    </div>
                </div>
                <div class="col-md-6 col-xl-4">
                    <div class="header" id="ret-div" style="background-color: green; color: white"
                    data-toggle="tooltip" data-placement="right" title="Chart presents the percentage accuracy in case of winning tiebreak games, winning points in opponent's games services 
                    both in case of 1st and 2nd service. There is also attacking efficiency shown by % of breakpoints converted in rival's service games.">RETURN STATS</div>
                    <div class="jumbotron">
                        <canvas id="rettbChart" height="100" width="150"></canvas>
                    </div>
                </div>

                <div class="col-md-6 col-xl-4">
                    <div class="header" id="polar-div" style="background-color: blue; color: white"
                    data-toggle="tooltip" data-placement="right" title="Graphics presents players' strengths - average count of Aces and Breakpoints won per set, contrasted with weaknesses - 
                    average count of Double Faults and Breakpoints conceded per set. It's valuable option to recognize and compare the types of players - attacking, well-serving, or defensive oriented.">POLAR GRAPH</div>
                    <div class="jumbotron">
                        <canvas id="numbersPolar" height="100" width="150"></canvas>
                    </div>
                    
                </div>
                <div class="col-md-12 col-xl-8">
                    <div class="header" id="odds-div" style="background-color: orange; color: white"
                    data-toggle="tooltip" data-placement="right" title="Analysis of average players' win percentage in various pre-match scenarios typed by bookmakers.
                    Surety - clear game favorite with odd less than 1.20, Favorite - game favorite with odd between 1.20 - 1.50, Slight favorite - odd between 1.50 and 1.80, 
                    Contender - opponent is the favorite with odd 1.50 - 1.80, Outsider - opponent is favorite with odd 1.20 - 1.50, Underdog - opponent's odd is less than 1.20">ODDS STATS</div>
                    <div class="jumbotron">
                        <canvas id="oddsChart" height="93"></canvas>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- <script type="text/javascript">

            $(document).ready(function() {
                $('.js-example-basic-single').select2({
                    placeholder: "Search for your Player",
                    allowClear: true
                });
            });

            $(function() {
                $('.footable').footable();
            });

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            })

            let primaryTab = document.getElementById("primarytab");
            let primaryPld = primaryTab.rows[1];
            let primaryWon = primaryTab.rows[2];
            let primaryLost = primaryTab.rows[3];
            let primaryPerc = primaryTab.rows[4];
            let primaryPldTd = primaryPld.getElementsByTagName("td");
            let primaryWonTd = primaryWon.getElementsByTagName("td");
            let primaryLostTd = primaryLost.getElementsByTagName("td");
            let primaryPercTd = primaryPerc.getElementsByTagName("td");

            let compareDescDiv = document.getElementById("comparedescdiv");
            let compareDesc = document.getElementById("comparedesc").getElementsByTagName("thead")[0].rows[0].getElementsByTagName("th");

            let compareTabDiv = document.getElementById("comparetabdiv");
            let compareTab = document.getElementById("comparetab");
            let comparePld = compareTab.rows[1];
            let compareWon = compareTab.rows[2];
            let compareLost = compareTab.rows[3];
            let comparePerc = compareTab.rows[4];
            let comparePldTd = comparePld.getElementsByTagName("td");
            let compareWonTd = compareWon.getElementsByTagName("td");
            let compareLostTd = compareLost.getElementsByTagName("td");
            let comparePercTd = comparePerc.getElementsByTagName("td");

            function changeTableRow(rowToChange, dataToPut) {

                for (let i = 0; i < rowToChange.length; i++) {
                        rowToChange[i].textContent = String(dataToPut[i]);
                }
            };

            function fillTableData(lost_array, perc_array, data_array) {

                for (let i = 0; i < data_array[0].length; i++) {
                    lost_array.push(data_array[0][i] - data_array[1][i]);
                };

                for (let i = 0; i < data_array[0].length; i++) {
                    if(data_array[0][i] != 0) {
                        perc_array.push((data_array[1][i] / data_array[0][i] * 100).toFixed(1));
                    }
                    else {
                        perc_array.push('-');
                    }
                };
            };            
            
            let player_perc = [];
            for (let i = 0; i < primaryPldTd.length; i++) {
                if(primaryPldTd[i].textContent != '0') {
                    player_perc.push((primaryWonTd[i].textContent / primaryPldTd[i].textContent * 100).toFixed(1));
                }
                else {
                    player_perc.push('-');
                }
            };

            changeTableRow(primaryPercTd, player_perc);

            var servaccChart = document.getElementById('servaccChart').getContext('2d');
            var serviceAccuracy = new Chart(servaccChart, {
            type: 'horizontalBar',
            data: {
                labels: ['First serve accuracy', 'First serve % pts', 'Second serve % pts', 'Breakpoints saved ratio %'],
                datasets: [{
                    backgroundColor: ['#706fd3', '#ef5777', '#ff5e57', '#0be881'],
                    hoverBackgroundColor: ['#474787', '#f53b57', '#ff3f34', '#05c46b'],
                    label: '{{ player.Name }}',
                    data: ['{{ player.First_serve_accuracy|floatformat:"1" }}', '{{ player.First_serve_points|floatformat:"1" }}', 
                    '{{ player.Second_serve_points|floatformat:"1" }}', '{{ player.Breakpoints_saved_ratio|floatformat:"1" }}']}]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            min: 0,
                            }
                        }]
                    },
                legend: {
                    display: false
                    }
                }
            });


            var rettbChart = document.getElementById('rettbChart').getContext('2d');
            var returnTbs = new Chart(rettbChart, {
            type: 'horizontalBar',
            data: {
                labels: ['Tiebreak wins ratio %', 'Return 1st serve % pts', 'Return 2nd serve % pts', 'Breakpoints converted ratio %'],
                datasets: [{
                    backgroundColor: ['rgba(153,204,255,1)', '#ffc048', 'rgba(255,204,0,1)', '#c44569'],
                    hoverBackgroundColor: ['rgba(153,153,255,1)', '#ffa801', 'rgba(255,153,0,1)', 'purple'],
                    label: '{{ player.Name }}',
                    data: ['{{ player.Tiebreak_won_perc|floatformat:"1" }}', '{{ player.Return_1st_serve_points|floatformat:"1" }}', 
                    '{{ player.Return_2nd_serve_points|floatformat:"1" }}', '{{ player.Breakpoints_converted_ratio|floatformat:"1" }}']}]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            min: 0
                            }
                        }]
                    },
                legend: {
                    display: false
                    }
                }
            });


            var numbersPolar = new Chart(document.getElementById("numbersPolar").getContext("2d"))
            var numericStats = new Chart(numbersPolar, {
            type: 'polarArea',
            data: {
                labels: ['Aces', 'Double Faults', 'BPs to save', 'BPs created'],
                datasets: [{
                    label: 'Numeric stats',
                    backgroundColor: ["#27ae60", "#c0392b", "#f39c12", "#6d214f"],
                    data: ['{{ player.Aces_AVG|floatformat:"1" }}', '{{ player.DoubleFaults_AVG|floatformat:"1" }}', 
                    '{{ player.Breakpoints_to_defend_per_set|floatformat:"1" }}', '{{ player.Breakpoints_created_per_set|floatformat:"1" }}'],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 0,
                        right: 0,
                        top: 0,
                        bottom: 0
                        }
                    },
                },
            });

            var spiderChart = new Chart(document.getElementById("spider").getContext("2d"))
            var skills = new Chart(spiderChart, {
            type: 'radar',
            data: {
                labels: ['1st Srv Acc %','1st Srv %','2nd Srv %', 'BPs save %','Srv Games %',
                'Ret 1st %','Ret 2nd %', 'BPs convert %', 'Ret Games %','Tiebreak %'],
                datasets: [{
                    label: '{{ player.Name }}',
                    backgroundColor: "rgba(3, 88, 106, 0.2)",
                    borderColor: "rgba(3, 88, 106, 0.80)",
                    pointBackgroundColor: "rgba(3, 88, 106 ,0.6)",
                    pointBorderColor: "rgba(3, 88, 106 ,0.6)",
                    pointHoverBackgroundColor: "rgba(3, 88, 106, 0.8)",
                    pointHoverBorderColor: "rgba(220, 220, 220, 1)",
                    pointRadius: 4,
                    pointHoverRadius: 8,
                    borderRadius: 15,
                    lineWidth: 8,
                    borderCapStyle: 'round',
                    data: ['{{ player.First_serve_accuracy|floatformat:"1" }}', '{{ player.First_serve_points|floatformat:"1" }}', '{{ player.Second_serve_points|floatformat:"1" }}',
                    '{{ player.Breakpoints_saved_ratio|floatformat:"1" }}', '{{ player.Service_games_won_ratio|floatformat:"1" }}', '{{ player.Return_1st_serve_points|floatformat:"1" }}',
                    '{{ player.Return_2nd_serve_points|floatformat:"1" }}', '{{ player.Breakpoints_converted_ratio|floatformat:"1" }}', '{{ player.Return_games_won_ratio|floatformat:"1" }}', '{{ player.Tiebreak_won_perc|floatformat:"1" }}'],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 0,
                        right: 0,
                        top: 0,
                        bottom: 0
                    }
                },
                legend: { display: true },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                        return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                        }
                    }
                },

                scale: {
                    ticks: {
                        max: 100, min: 0, stepSize: 20
                    },
                    gridLines: {
                        color: '#666666',
                        lineWidth: 0.6,
                    },

                    angleLines: {
                        display: false
                        }
                    }
                },
            });

            var oddsChart = new Chart(document.getElementById("oddsChart").getContext("2d"))
            var odds = new Chart(oddsChart, {
                type: 'bar',
                data: {
                labels: ["Surety", "Favorite", "Slight favorite", "Contender", "Outsider", "Underdog"],
                datasets: [
                    {
                    backgroundColor: ["#44B91C", "#8e5ea2","#3cba9f","#e8c3b9","#c45850", '#7f8c8d'],
                    data: [],
                    }
                ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                    yAxes: [{
                        ticks: {
                            max: 100,
                            min: 0,
                            stepSize: 20
                            }
                        }]
                    },
                    legend: { display: false },
                }
            });

            let btnOvrMain = document.querySelector('#btn-ovr');
            let btnOvrOvr = document.querySelector('#btn-ovr-ovr');
            let btnOvrYear = document.querySelector('#btn-ovr-year');
            let btnOvrCur = document.querySelector('#btn-ovr-cur');
            let btnHardMain = document.querySelector('#btn-hard');
            let btnHardOvr = document.querySelector('#btn-hard-ovr');
            let btnHardYear = document.querySelector('#btn-hard-year');
            let btnHardCur = document.querySelector('#btn-hard-cur');
            let btnClayMain = document.querySelector('#btn-clay');
            let btnClayOvr = document.querySelector('#btn-clay-ovr');
            let btnClayYear = document.querySelector('#btn-clay-year');
            let btnClayCur = document.querySelector('#btn-clay-cur');

            let ovr = {{ ovr|safe }};
            let ovryear = {{ ovryear|safe }};
            let ovrcur = {{ ovrcur|safe }};
            let clay = {{ clay|safe }};
            let clayyear = {{ clayyear|safe }};
            let claycur = {{ claycur|safe }};
            let hard = {{ hard|safe }};
            let hardyear = {{ hardyear|safe }};
            let hardcur = {{ hardcur|safe }};

            let comparePlayerVar = '';
            let currentScenario = ovr ;

            let suretyPerc = ({{ player.Surety_won }} / {{ player.Surety_played }} * 100).toFixed(1);
            let favPerc = ({{ player.Favorite_won }} / {{ player.Favorite_played }} * 100).toFixed(1);
            let sliFavPerc = ({{ player.Slightfav_won }} / {{ player.Slightfav_played }} * 100).toFixed(1);
            let contPerc = ({{ player.Slightunder_won }} / {{ player.Slightunder_played }} * 100).toFixed(1);
            let outPerc = ({{ player.Under_won }} / {{ player.Under_played }} * 100).toFixed(1);
            let undPerc = ({{ player.Underdog_won }} / {{ player.Underdog_played }} * 100).toFixed(1);

            odds.data.datasets[0] = {
            label: '{{ player.Name }}',
            backgroundColor: ["#44B91C", "#8e5ea2","#3cba9f","#e8c3b9","#c45850", '#7f8c8d'],
            data: [suretyPerc, favPerc, sliFavPerc, contPerc, outPerc, undPerc]};
            odds.update();

            allPlayers = [];
            ovr.forEach(function(man) {
                    allPlayers.push(String(man.pk));
                });

            function visualizePlayer(element, scenario, tekst, backcolor) {
                element.addEventListener("click", function (e) {
                    document.getElementById('scenario-info').textContent = tekst;
                    document.getElementById('scenario-header').style.backgroundColor = backcolor;
                    document.getElementById('scenario-info').style.backgroundColor = backcolor;
                    currentScenario = scenario;
                    let playersList = [];
                    scenario.forEach(function(man) {
                        playersList.push(String(man.pk));
                    });

                    let playerIndex = playersList.indexOf('{{ player.id }}');

                    if(playerIndex > -1) {

                        var primaryPlayerData = [
                            [scenario[playerIndex].fields['Matches_played'], scenario[playerIndex].fields['Tiebreak_played'], 
                            scenario[playerIndex].fields['Surety_played'], scenario[playerIndex].fields['Favorite_played'],
                            scenario[playerIndex].fields['Slightfav_played'], scenario[playerIndex].fields['Slightunder_played'], 
                            scenario[playerIndex].fields['Under_played'], scenario[playerIndex].fields['Underdog_played']],

                            [scenario[playerIndex].fields['Matches_won'], scenario[playerIndex].fields['Tiebreak_won'], 
                            scenario[playerIndex].fields['Surety_won'], scenario[playerIndex].fields['Favorite_won'],
                            scenario[playerIndex].fields['Slightfav_won'], scenario[playerIndex].fields['Slightunder_won'], 
                            scenario[playerIndex].fields['Under_won'], scenario[playerIndex].fields['Underdog_won']]
                        ];

                        let primaryLostArr = [];
                        let primaryPercArr = [];

                        fillTableData(primaryLostArr, primaryPercArr, primaryPlayerData);
                        
                        changeTableRow(primaryPldTd, primaryPlayerData[0]);
                        changeTableRow(primaryWonTd, primaryPlayerData[1]);
                        changeTableRow(primaryLostTd, primaryLostArr);
                        changeTableRow(primaryPercTd, primaryPercArr);

                        serviceAccuracy.data.datasets[0].data = [scenario[playerIndex].fields['First_serve_accuracy'], scenario[playerIndex].fields['First_serve_points'],
                            scenario[playerIndex].fields['Second_serve_points'], scenario[playerIndex].fields['Breakpoints_saved_ratio']];
                        serviceAccuracy.update();

                        returnTbs.data.datasets[0].data = [scenario[playerIndex].fields['Tiebreak_won_perc'], scenario[playerIndex].fields['Return_1st_serve_points'],
                            scenario[playerIndex].fields['Return_2nd_serve_points'], scenario[playerIndex].fields['Breakpoints_converted_ratio']];
                        returnTbs.update();
                        
                        skills.data.datasets[0].data = [scenario[playerIndex].fields['First_serve_accuracy'], scenario[playerIndex].fields['First_serve_points'], scenario[playerIndex].fields['Second_serve_points'],
                        scenario[playerIndex].fields['Breakpoints_saved_ratio'], scenario[playerIndex].fields['Service_games_won_ratio'], scenario[playerIndex].fields['Return_1st_serve_points'],
                        scenario[playerIndex].fields['Return_2nd_serve_points'], scenario[playerIndex].fields['Breakpoints_converted_ratio'], scenario[playerIndex].fields['Return_games_won_ratio'], 
                        scenario[playerIndex].fields['Tiebreak_won_perc']];
                        skills.update();

                        if(numericStats.data.datasets[0].data.length <= 4) {
                            numericStats.data.datasets[0].data = [scenario[playerIndex].fields['Aces_AVG'], scenario[playerIndex].fields['DoubleFaults_AVG'],
                            scenario[playerIndex].fields['Breakpoints_to_defend_per_set'], scenario[playerIndex].fields['Breakpoints_created_per_set']];
                            numericStats.update();
                            }

                        else {
                            numericStatsArray = numericStats.data.datasets[0].data[0] = String(scenario[playerIndex].fields['Aces_AVG']);
                            numericStatsArray = numericStats.data.datasets[0].data[2] = String(scenario[playerIndex].fields['DoubleFaults_AVG']);
                            numericStatsArray = numericStats.data.datasets[0].data[4] = String(scenario[playerIndex].fields['Breakpoints_to_defend_per_set']);
                            numericStatsArray = numericStats.data.datasets[0].data[6] = String(scenario[playerIndex].fields['Breakpoints_created_per_set']);
                            numericStats.update();
                            }

                        odds.data.datasets.pop();
                        odds.data.datasets[0] = {
                            label: scenario[playerIndex].fields['Name'],
                            backgroundColor: ["#44B91C", "#8e5ea2","#3cba9f","#e8c3b9","#c45850", '#7f8c8d'],
                            data: [
                            (scenario[playerIndex].fields['Surety_won'] / scenario[playerIndex].fields['Surety_played'] * 100).toFixed(1),
                            (scenario[playerIndex].fields['Favorite_won'] / scenario[playerIndex].fields['Favorite_played'] * 100).toFixed(1),
                            (scenario[playerIndex].fields['Slightfav_won'] / scenario[playerIndex].fields['Slightfav_played'] * 100).toFixed(1),
                            (scenario[playerIndex].fields['Slightunder_won'] / scenario[playerIndex].fields['Slightunder_played'] * 100).toFixed(1),
                            (scenario[playerIndex].fields['Under_won'] / scenario[playerIndex].fields['Under_played'] * 100).toFixed(1),
                            (scenario[playerIndex].fields['Underdog_won'] / scenario[playerIndex].fields['Underdog_played'] * 100).toFixed(1)]};

                        odds.update();
                        }

                    else {

                        changeTableRow(primaryPldTd, new Array(8).fill('0'));
                        changeTableRow(primaryWonTd, new Array(8).fill('0'));
                        changeTableRow(primaryLostTd, new Array(8).fill('0'));
                        changeTableRow(primaryPercTd, new Array(8).fill('-'));

                        serviceAccuracy.data.datasets[0].data = new Array(4).fill(null);
                        serviceAccuracy.update();

                        returnTbs.data.datasets[0].data = new Array(4).fill(null);
                        returnTbs.update();

                        skills.data.datasets[0].data = new Array(10).fill(null);
                        skills.update();


                        if(numericStats.data.datasets[0].data.length <= 4) {
                            numericStats.data.datasets[0].data = new Array(4).fill(null);
                            numericStats.update();
                            }

                        else {
                            numericStats.data.datasets[0].data[0] = null;
                            numericStats.data.datasets[0].data[2] = null;
                            numericStats.data.datasets[0].data[4] = null;
                            numericStats.data.datasets[0].data[6] = null;
                            numericStats.update();
                            };
                        
                        odds.data.datasets.pop();
                        odds.data.datasets[0] = {
                            label: "{{ player.Name }}",
                            backgroundColor: ["#44B91C", "#8e5ea2","#3cba9f","#e8c3b9","#c45850", '#7f8c8d'],
                            data: []};

                        odds.update();

                        };

                    if(comparePlayerVar != '') {
                        comparePlayerIndex = playersList.indexOf(comparePlayerVar);
                        if(comparePlayerIndex > -1) {

                            console.log(currentScenario[comparePlayerIndex].fields['Name']);
                            console.log(currentScenario[comparePlayerIndex].fields['Rank']);
                            
                            var comparePlayerData = [
                                    [currentScenario[comparePlayerIndex].fields['Matches_played'], currentScenario[comparePlayerIndex].fields['Tiebreak_played'], 
                                    currentScenario[comparePlayerIndex].fields['Surety_played'], currentScenario[comparePlayerIndex].fields['Favorite_played'],
                                    currentScenario[comparePlayerIndex].fields['Slightfav_played'], currentScenario[comparePlayerIndex].fields['Slightunder_played'], 
                                    currentScenario[comparePlayerIndex].fields['Under_played'], currentScenario[comparePlayerIndex].fields['Underdog_played']],

                                    [currentScenario[comparePlayerIndex].fields['Matches_won'], currentScenario[comparePlayerIndex].fields['Tiebreak_won'], 
                                    currentScenario[comparePlayerIndex].fields['Surety_won'], currentScenario[comparePlayerIndex].fields['Favorite_won'],
                                    currentScenario[comparePlayerIndex].fields['Slightfav_won'], currentScenario[comparePlayerIndex].fields['Slightunder_won'], 
                                    currentScenario[comparePlayerIndex].fields['Under_won'], currentScenario[comparePlayerIndex].fields['Underdog_won']]
                                ];

                            let compareLostArr = [];
                            let comparePercArr = [];

                            fillTableData(compareLostArr, comparePercArr, comparePlayerData);
                            
                            changeTableRow(comparePldTd, comparePlayerData[0]);
                            changeTableRow(compareWonTd, comparePlayerData[1]);
                            changeTableRow(compareLostTd, compareLostArr);
                            changeTableRow(comparePercTd, comparePercArr);

                            console.log('ten drugi: ', comparePlayerVar);

                            serviceAccuracy.data.datasets[1].data = [scenario[comparePlayerIndex].fields['First_serve_accuracy'], scenario[comparePlayerIndex].fields['First_serve_points'],
                            scenario[comparePlayerIndex].fields['Second_serve_points'], scenario[comparePlayerIndex].fields['Breakpoints_saved_ratio']];
                            serviceAccuracy.update();

                            returnTbs.data.datasets[1].data = [scenario[comparePlayerIndex].fields['Tiebreak_won_perc'], scenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                            scenario[comparePlayerIndex].fields['Return_2nd_serve_points'], scenario[comparePlayerIndex].fields['Breakpoints_converted_ratio']];
                            returnTbs.update();
                            
                            if(numericStats.data.datasets[0].data.length <= 4) {
                                numericStats.data.datasets[0].data.splice(1, 0, String(scenario[comparePlayerIndex].fields['Aces_AVG']));
                                numericStats.data.labels.splice(1, 0, 'Aces - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(1, 0, 'green');
                                numericStats.data.datasets[0].data.splice(3, 0, String(scenario[comparePlayerIndex].fields['DoubleFaults_AVG']));
                                numericStats.data.labels.splice(3, 0, 'DFs - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(3, 0, 'red');
                                numericStats.data.datasets[0].data.splice(5, 0, String(scenario[comparePlayerIndex].fields['Breakpoints_to_defend_per_set']));
                                numericStats.data.labels.splice(5, 0, 'BPs to save - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(5, 0, 'yellow');
                                numericStats.data.datasets[0].data.splice(7, 0, String(scenario[comparePlayerIndex].fields['Breakpoints_created_per_set']));
                                numericStats.data.labels.splice(7, 0, 'BPs created - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(7, 0, 'purple');
                                numericStats.update();
                            }

                            else {
                                numericStats.data.datasets[0].data[1] = String(scenario[comparePlayerIndex].fields['Aces_AVG']);
                                numericStats.data.datasets[0].data[3] = String(scenario[comparePlayerIndex].fields['DoubleFaults_AVG']);
                                numericStats.data.datasets[0].data[5] = String(scenario[comparePlayerIndex].fields['Breakpoints_to_defend_per_set']);
                                numericStats.data.datasets[0].data[7] = String(scenario[comparePlayerIndex].fields['Breakpoints_created_per_set']);
                                numericStats.data.labels[1] = 'Aces - rival';
                                numericStats.data.datasets[0].backgroundColor[1] = 'green';
                                numericStats.data.labels[3] = 'DFs - rival';
                                numericStats.data.datasets[0].backgroundColor[3] = 'red';
                                numericStats.data.labels[5] = 'BPs to save - rival';
                                numericStats.data.datasets[0].backgroundColor[5] = 'yellow';
                                numericStats.data.labels[7] = 'BPs created - rival';
                                numericStats.data.datasets[0].backgroundColor[7] = 'purple';
                                numericStats.update();
                            };

                            skills.data.datasets[1] = {
                                label: scenario[comparePlayerIndex].fields['Name'],
                                backgroundColor: "rgba(255,51,102,0.2)",
                                borderColor: "rgba(255,51,102,0.85)",
                                pointColor: "rgba(255,51,102,0.85)",

                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [scenario[comparePlayerIndex].fields['First_serve_accuracy'], scenario[comparePlayerIndex].fields['First_serve_points'], scenario[comparePlayerIndex].fields['Second_serve_points'],
                                scenario[comparePlayerIndex].fields['Breakpoints_saved_ratio'], scenario[comparePlayerIndex].fields['Service_games_won_ratio'], scenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                                scenario[comparePlayerIndex].fields['Return_2nd_serve_points'], scenario[comparePlayerIndex].fields['Breakpoints_converted_ratio'], scenario[comparePlayerIndex].fields['Return_games_won_ratio'], 
                                scenario[comparePlayerIndex].fields['Tiebreak_won_perc']]
                            };
                            skills.update();

                            odds.data.datasets[1] = {
                                backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                                label: scenario[comparePlayerIndex].fields['Name'],
                                data: [
                                (scenario[comparePlayerIndex].fields['Surety_won'] / scenario[comparePlayerIndex].fields['Surety_played'] * 100).toFixed(1),
                                (scenario[comparePlayerIndex].fields['Favorite_won'] / scenario[comparePlayerIndex].fields['Favorite_played'] * 100).toFixed(1),
                                (scenario[comparePlayerIndex].fields['Slightfav_won'] / scenario[comparePlayerIndex].fields['Slightfav_played'] * 100).toFixed(1),
                                (scenario[comparePlayerIndex].fields['Slightunder_won'] / scenario[comparePlayerIndex].fields['Slightunder_played'] * 100).toFixed(1),
                                (scenario[comparePlayerIndex].fields['Under_won'] / scenario[comparePlayerIndex].fields['Under_played'] * 100).toFixed(1),
                                (scenario[comparePlayerIndex].fields['Underdog_won'] / scenario[comparePlayerIndex].fields['Underdog_played'] * 100).toFixed(1)]};

                            odds.update();                        
                        }

                        else {

                            changeTableRow(comparePldTd, new Array(8).fill('0'));
                            changeTableRow(compareWonTd, new Array(8).fill('0'));
                            changeTableRow(compareLostTd, new Array(8).fill('0'));
                            changeTableRow(comparePercTd, new Array(8).fill('-'));

                            serviceAccuracy.data.datasets[1].data = new Array(4).fill(null);
                            serviceAccuracy.update();

                            returnTbs.data.datasets[1].data = new Array(4).fill(null);
                            returnTbs.update();

                            if(numericStats.data.datasets[0].data.length <= 4) {
                                numericStats.data.datasets[0].data.splice(1, 0, null);
                                numericStats.data.datasets[0].data.splice(3, 0, null);
                                numericStats.data.datasets[0].data.splice(5, 0, null);
                                numericStats.data.datasets[0].data.splice(7, 0, null);
                                numericStats.data.labels.splice(1, 0, 'Aces - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(1, 0, 'green');
                                numericStats.data.labels.splice(3, 0, 'DFs - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(3, 0, 'red');
                                numericStats.data.labels.splice(5, 0, 'BPs to save - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(5, 0, 'yellow');
                                numericStats.data.labels.splice(7, 0, 'BPs created - rival');
                                numericStats.data.datasets[0].backgroundColor.splice(7, 0, 'purple');
                                numericStats.update();
                            }

                            else {
                                numericStats.data.datasets[0].data[1] = null;
                                numericStats.data.datasets[0].data[3] = null;
                                numericStats.data.datasets[0].data[5] = null;
                                numericStats.data.datasets[0].data[7] = null;
                                numericStats.data.labels[1] = 'Aces - rival';
                                numericStats.data.datasets[0].backgroundColor[1] = 'green';
                                numericStats.data.labels[3] = 'DFs - rival';
                                numericStats.data.datasets[0].backgroundColor[3] = 'red';
                                numericStats.data.labels[5] = 'BPs to save - rival';
                                numericStats.data.datasets[0].backgroundColor[5] = 'yellow';
                                numericStats.data.labels[7] = 'BPs created - rival';
                                numericStats.data.datasets[0].backgroundColor[7] = 'purple';
                                numericStats.update();
                            }

                            skills.data.datasets[1] = {
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                backgroundColor: "rgba(255, 51, 102, 0.2)",
                                borderColor: "rgba(255, 51, 102, 0.85)",
                                pointBackgroundColor: "rgba(255, 51, 102, 0.85)",
                                pointBorderColor: "rgba(255, 51, 102, 0.85)",
                                pointHoverBackgroundColor: "rgba(255, 51, 102, 0.8)",
                                pointHoverBorderColor: "rgba(255, 51, 102, 1)",
                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [new Array(10).fill(null)]
                            };
                            skills.update();

                            odds.data.datasets[1] = {
                                backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                data: []};
                            odds.update(); 
                        }
                    }

                    });
                };

            function delCompare(del) {
                if (del) {
                    del.addEventListener("click", function (e) {
                        document.getElementById('del-test').style.display="none";
                        comparePlayerVar = '';
                        serviceSet = serviceAccuracy.data.datasets;
                        returnSet = returnTbs.data.datasets;
                        skillsSet = skills.data.datasets;
                        oddsSet = odds.data.datasets;
                        numericStatsArray = numericStats.data.datasets[0].data
                        numericStatsLabels = numericStats.data.labels;
                        numericStatsColors = numericStats.data.datasets[0].backgroundColor;

                        if (serviceSet.length > 1) {

                            compareTabDiv.style.display = "none";
                            compareDescDiv.style.display = "none";
                            serviceSet.pop();
                            serviceAccuracy.update();

                            returnSet.pop();
                            returnTbs.update();

                            skillsSet.pop();
                            skills.update();

                            oddsSet.pop();
                            odds.update();

                            numericStatsArray.splice(7, 1);
                            numericStatsArray.splice(5, 1);
                            numericStatsArray.splice(3, 1);
                            numericStatsArray.splice(1, 1);
                            numericStatsLabels.splice(7, 1);
                            numericStatsLabels.splice(5, 1);
                            numericStatsLabels.splice(3, 1);
                            numericStatsLabels.splice(1, 1);
                            numericStatsColors.splice(7, 1);
                            numericStatsColors.splice(5, 1);
                            numericStatsColors.splice(3, 1);
                            numericStatsColors.splice(1, 1);
                            numericStats.update();

                        };
                    });
                };
            };

            delCompare(document.querySelector('#del-test'));

            let selectRecognition = {};

            for (let i = 0; i < ovr.length; i++) {
                selectRecognition['#' + ovr[i]['fields']['Rank'] + ' ' + ovr[i]['fields']['Name']] = [ovr[i]['pk'], ovr[i]['fields']['Name']];
            };

            $('.js-example-basic-single').on('select2:select', function (e) {
                let selectValue = e.params.data['text'];
            });

            function comparePlayer() {
                $('.js-example-basic-single').on('select2:select', function (e) {
                    document.getElementById('del-test').style.display = 'block';
                    let selectValue = e.params.data['text'];

                    serviceSet = serviceAccuracy.data.datasets;
                    returnSet = returnTbs.data.datasets;
                    skillsSet = skills.data.datasets;
                    numericStatsArray = numericStats.data.datasets[0].data
                    numericStatsLabels = numericStats.data.labels;
                    numericStatsColors = numericStats.data.datasets[0].backgroundColor;

                    let compareName = selectRecognition[selectValue][0];
                    comparePlayerVar = compareName;
                    let playersList = [];
                    currentScenario.forEach(function(man) {
                        playersList.push(String(man.pk));
                    });

                    let comparePlayerIndex = playersList.indexOf(compareName);

                    if(comparePlayerIndex > -1) {

                        var comparePlayerData = [
                                [currentScenario[comparePlayerIndex].fields['Matches_played'], currentScenario[comparePlayerIndex].fields['Tiebreak_played'], 
                                currentScenario[comparePlayerIndex].fields['Surety_played'], currentScenario[comparePlayerIndex].fields['Favorite_played'],
                                currentScenario[comparePlayerIndex].fields['Slightfav_played'], currentScenario[comparePlayerIndex].fields['Slightunder_played'], 
                                currentScenario[comparePlayerIndex].fields['Under_played'], currentScenario[comparePlayerIndex].fields['Underdog_played']],

                                [currentScenario[comparePlayerIndex].fields['Matches_won'], currentScenario[comparePlayerIndex].fields['Tiebreak_won'], 
                                currentScenario[comparePlayerIndex].fields['Surety_won'], currentScenario[comparePlayerIndex].fields['Favorite_won'],
                                currentScenario[comparePlayerIndex].fields['Slightfav_won'], currentScenario[comparePlayerIndex].fields['Slightunder_won'], 
                                currentScenario[comparePlayerIndex].fields['Under_won'], currentScenario[comparePlayerIndex].fields['Underdog_won']]
                            ];

                        let compareLostArr = [];
                        let comparePercArr = [];

                        fillTableData(compareLostArr, comparePercArr, comparePlayerData);
                        
                        changeTableRow(comparePldTd, comparePlayerData[0]);
                        changeTableRow(compareWonTd, comparePlayerData[1]);
                        changeTableRow(compareLostTd, compareLostArr);
                        changeTableRow(comparePercTd, comparePercArr);

                        compareDesc[0].textContent = currentScenario[comparePlayerIndex].fields['Name'];
                        compareDesc[1].textContent = "Rank: " + String(currentScenario[comparePlayerIndex].fields['Rank']);

                        compareTabDiv.style.display = "inline";
                        compareDescDiv.style.display = "inline";

                        if (serviceSet.length == 1) {

                            serviceSet.push({
                                backgroundColor: ['#778ca3', '#f8a5c2', '#ea8685', '#7EC66C'],
                                hoverBackgroundColor: ['#4b6584', '#f78fb3', '#e66767', '#6DA75E'],
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                data: [currentScenario[comparePlayerIndex].fields['First_serve_accuracy'], currentScenario[comparePlayerIndex].fields['First_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Second_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_saved_ratio']]});
                            serviceAccuracy.update();

                            returnSet.push({
                                backgroundColor: ['#596275', '#e77f67', '#e15f41', '#a55eea'],
                                hoverBackgroundColor: ['#303952', '#cf6a87', '#c44569', '#8854d0'],
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                data: [currentScenario[comparePlayerIndex].fields['Tiebreak_won_perc'], currentScenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Return_2nd_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_converted_ratio']]});
                            returnTbs.update();

                            numericStatsArray.splice(1, 0, String(currentScenario[comparePlayerIndex].fields['Aces_AVG']));
                            numericStatsArray.splice(3, 0, String(currentScenario[comparePlayerIndex].fields['DoubleFaults_AVG']));
                            numericStatsArray.splice(5, 0, String(currentScenario[comparePlayerIndex].fields['Breakpoints_to_defend_per_set']));
                            numericStatsArray.splice(7, 0, String(currentScenario[comparePlayerIndex].fields['Breakpoints_created_per_set']));
                            numericStatsLabels.splice(1, 0, 'Aces - rival');
                            numericStatsColors.splice(1, 0, 'green');
                            numericStatsLabels.splice(3, 0, 'DFs - rival');
                            numericStatsColors.splice(3, 0, 'red');
                            numericStatsLabels.splice(5, 0, 'BPs to save - rival');
                            numericStatsColors.splice(5, 0, 'yellow');
                            numericStatsLabels.splice(7, 0, 'BPs created - rival');
                            numericStatsColors.splice(7, 0, 'purple');
                            numericStats.update();

                            skillsSet.push({
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                backgroundColor: "rgba(255, 51, 102, 0.2)",
                                borderColor: "rgba(255, 51, 102, 0.85)",
                                pointBackgroundColor: "rgba(255, 51, 102, 0.85)",
                                pointBorderColor: "rgba(255, 51, 102, 0.85)",
                                pointHoverBackgroundColor: "rgba(255, 51, 102, 0.8)",
                                pointHoverBorderColor: "rgba(255, 51, 102, 1)",
                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [currentScenario[comparePlayerIndex].fields['First_serve_accuracy'], currentScenario[comparePlayerIndex].fields['First_serve_points'], currentScenario[comparePlayerIndex].fields['Second_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Breakpoints_saved_ratio'], currentScenario[comparePlayerIndex].fields['Service_games_won_ratio'], currentScenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Return_2nd_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_converted_ratio'], currentScenario[comparePlayerIndex].fields['Return_games_won_ratio'], 
                                currentScenario[comparePlayerIndex].fields['Tiebreak_won_perc']]
                            });
                            skills.update();
                            
                            odds.data.datasets.push({
                            backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                            label: currentScenario[comparePlayerIndex].fields['Name'],
                            data: [
                            (currentScenario[comparePlayerIndex].fields['Surety_won'] / currentScenario[comparePlayerIndex].fields['Surety_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Favorite_won'] / currentScenario[comparePlayerIndex].fields['Favorite_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Slightfav_won'] / currentScenario[comparePlayerIndex].fields['Slightfav_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Slightunder_won'] / currentScenario[comparePlayerIndex].fields['Slightunder_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Under_won'] / currentScenario[comparePlayerIndex].fields['Under_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Underdog_won'] / currentScenario[comparePlayerIndex].fields['Underdog_played'] * 100).toFixed(1)]});

                            odds.update();

                        }

                        else if (serviceSet.length > 1) {

                            serviceSet.pop();
                            serviceSet.push({
                                backgroundColor: ['#596275', '#e77f67', '#e15f41', '#8ABE7D'],
                                hoverBackgroundColor: ['#303952', '#cf6a87', '#c44569', '#74A069'],
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                data: [currentScenario[comparePlayerIndex].fields['First_serve_accuracy'], currentScenario[comparePlayerIndex].fields['First_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Second_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_saved_ratio']]});
                            serviceAccuracy.update();
                            };

                            returnSet.pop();
                            returnSet.push({
                                backgroundColor: ['#596275', '#e77f67', '#e15f41', '#a55eea'],
                                hoverBackgroundColor: ['#303952', '#cf6a87', '#c44569', '#8854d0'],
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                data: [currentScenario[comparePlayerIndex].fields['Tiebreak_won_perc'], currentScenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Return_2nd_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_converted_ratio']]});
                            returnTbs.update();

                            numericStatsArray[1] = String(currentScenario[comparePlayerIndex].fields['Aces_AVG']);
                            numericStatsArray[3] = String(currentScenario[comparePlayerIndex].fields['DoubleFaults_AVG']);
                            numericStatsArray[5] = String(currentScenario[comparePlayerIndex].fields['Breakpoints_to_defend_per_set']);
                            numericStatsArray[7] = String(currentScenario[comparePlayerIndex].fields['Breakpoints_created_per_set']);
                            numericStatsLabels[1] = 'Aces - rival';
                            numericStatsColors[1] = 'green';
                            numericStatsLabels[3] = 'DFs - rival';
                            numericStatsColors[3] = 'red';
                            numericStatsLabels[5] = 'BPs to save - rival';
                            numericStatsColors[5] = 'yellow';
                            numericStatsLabels[7] = 'BPs created - rival';
                            numericStatsColors[7] = 'purple';
                            numericStats.update();

                            skillsSet.pop();
                            skillsSet.push({
                                label: currentScenario[comparePlayerIndex].fields['Name'],
                                backgroundColor: "rgba(255, 51, 102, 0.2)",
                                borderColor: "rgba(255, 51, 102, 0.85)",
                                pointBackgroundColor: "rgba(255, 51, 102, 0.85)",
                                pointBorderColor: "rgba(255, 51, 102, 0.85)",
                                pointHoverBackgroundColor: "rgba(255, 51, 102, 0.8)",
                                pointHoverBorderColor: "rgba(255, 51, 102, 1)",
                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [currentScenario[comparePlayerIndex].fields['First_serve_accuracy'], currentScenario[comparePlayerIndex].fields['First_serve_points'], currentScenario[comparePlayerIndex].fields['Second_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Breakpoints_saved_ratio'], currentScenario[comparePlayerIndex].fields['Service_games_won_ratio'], currentScenario[comparePlayerIndex].fields['Return_1st_serve_points'],
                                currentScenario[comparePlayerIndex].fields['Return_2nd_serve_points'], currentScenario[comparePlayerIndex].fields['Breakpoints_converted_ratio'], currentScenario[comparePlayerIndex].fields['Return_games_won_ratio'], 
                                currentScenario[comparePlayerIndex].fields['Tiebreak_won_perc']]
                            });
                            skills.update();

                            odds.data.datasets[1] = {
                            backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                            label: currentScenario[comparePlayerIndex].fields['Name'],
                            data: [
                            (currentScenario[comparePlayerIndex].fields['Surety_won'] / currentScenario[comparePlayerIndex].fields['Surety_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Favorite_won'] / currentScenario[comparePlayerIndex].fields['Favorite_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Slightfav_won'] / currentScenario[comparePlayerIndex].fields['Slightfav_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Slightunder_won'] / currentScenario[comparePlayerIndex].fields['Slightunder_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Under_won'] / currentScenario[comparePlayerIndex].fields['Under_played'] * 100).toFixed(1),
                            (currentScenario[comparePlayerIndex].fields['Underdog_won'] / currentScenario[comparePlayerIndex].fields['Underdog_played'] * 100).toFixed(1)]};

                            odds.update();
                        }

                    else {
    
                        changeTableRow(comparePldTd, new Array(8).fill('0'));
                        changeTableRow(compareWonTd, new Array(8).fill('0'));
                        changeTableRow(compareLostTd, new Array(8).fill('0'));
                        changeTableRow(comparePercTd, new Array(8).fill('-'));

                        compareDesc[0].textContent = ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'];
                        compareDesc[1].textContent = "Rank: " + String(ovr[allPlayers.indexOf(comparePlayerVar)].fields['Rank']);

                        compareTabDiv.style.display = "inline";
                        compareDescDiv.style.display = "inline";

                        if (serviceSet.length == 1) {

                            serviceSet.push({
                                label: selectRecognition[selectValue][1],
                                data: [new Array(4).fill(null)]});
                            serviceAccuracy.update();

                            returnSet.push({
                                label: selectRecognition[selectValue][1],
                                data: [new Array(4).fill(null)]});
                            returnTbs.update();

                            numericStatsArray.splice(1, 0, null);
                            numericStatsArray.splice(3, 0, null);
                            numericStatsArray.splice(5, 0, null);
                            numericStatsArray.splice(7, 0, null);
                            numericStatsLabels.splice(1, 0, 'Aces - rival');
                            numericStatsColors.splice(1, 0, 'green');
                            numericStatsLabels.splice(3, 0, 'DFs - rival');
                            numericStatsColors.splice(3, 0, 'red');
                            numericStatsLabels.splice(5, 0, 'BPs to save - rival');
                            numericStatsColors.splice(5, 0, 'yellow');
                            numericStatsLabels.splice(7, 0, 'BPs created - rival');
                            numericStatsColors.splice(7, 0, 'purple');
                            numericStats.update();

                            skillsSet.push({
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                backgroundColor: "rgba(255, 51, 102, 0.2)",
                                borderColor: "rgba(255, 51, 102, 0.85)",
                                pointBackgroundColor: "rgba(255, 51, 102, 0.85)",
                                pointBorderColor: "rgba(255, 51, 102, 0.85)",
                                pointHoverBackgroundColor: "rgba(255, 51, 102, 0.8)",
                                pointHoverBorderColor: "rgba(255, 51, 102, 1)",
                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [new Array(10).fill(null)]});
                            skills.update();

                            odds.data.datasets.push({
                                backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                data: [new Array(6).fill(null)]});
                            odds.update();
                            
                        }

                        else if (serviceSet.length > 1) {

                            serviceSet.pop();
                            serviceSet.push({
                                backgroundColor: ['#778ca3', '#f8a5c2', '#ea8685', '#7EC66C'],
                                hoverBackgroundColor: ['#4b6584', '#f78fb3', '#e66767', '#6DA75E'],
                                label: selectRecognition[selectValue][1],
                                data: [new Array(4).fill(null)]});
                            serviceAccuracy.update();

                            returnSet.pop();
                            returnSet.push({
                                backgroundColor: ['#596275', '#e77f67', '#e15f41', '#a55eea'],
                                hoverBackgroundColor: ['#303952', '#cf6a87', '#c44569', '#8854d0'],
                                label: selectRecognition[selectValue][1],
                                data: [new Array(4).fill(null)]});
                            returnTbs.update();

                            numericStatsArray[1] = null;
                            numericStatsArray[3] = null;
                            numericStatsArray[5] = null;
                            numericStatsArray[7] = null;
                            numericStatsLabels[1] = 'Aces - rival';
                            numericStatsColors[1] = 'green';
                            numericStatsLabels[3] = 'DFs - rival';
                            numericStatsColors[3] = 'red';
                            numericStatsLabels[5] = 'BPs to save - rival';
                            numericStatsColors[5] = 'yellow';
                            numericStatsLabels[7] = 'BPs created - rival';
                            numericStatsColors[7] = 'purple';
                            numericStats.update();

                            skillsSet.pop();
                            skillsSet.push({
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                backgroundColor: "rgba(255, 51, 102, 0.2)",
                                borderColor: "rgba(255, 51, 102, 0.85)",
                                pointBackgroundColor: "rgba(255, 51, 102, 0.85)",
                                pointBorderColor: "rgba(255, 51, 102, 0.85)",
                                pointHoverBackgroundColor: "rgba(255, 51, 102, 0.8)",
                                pointHoverBorderColor: "rgba(255, 51, 102, 1)",
                                pointRadius: 4,
                                pointHoverRadius: 8,
                                borderRadius: 15,
                                lineWidth: 8,
                                borderCapStyle: 'round',
                                data: [new Array(10).fill(null)]});
                            skills.update();

                            odds.data.datasets[1] = {
                                backgroundColor: ["#b8e994", "#e056fd","#74b9ff","#f8c291","#e74c3c", '#95a5a6'],
                                label: ovr[allPlayers.indexOf(comparePlayerVar)].fields['Name'],
                                data: [new Array(6).fill(null)]};
                            odds.update();

                            };
                        };                        
                    });
                };

            visualizePlayer(btnOvrMain, ovr, 'All surfaces, overall', '#df2e2b');
            visualizePlayer(btnOvrOvr, ovr, 'All surfaces, overall', '#df2e2b');
            visualizePlayer(btnOvrYear, ovryear, 'All surfaces, 2020 year', '#df2e2b');
            visualizePlayer(btnOvrCur, ovrcur, 'All surfaces, after lockdown', '#df2e2b');
            visualizePlayer(btnHardMain, hard, 'Hard courts, overall', '#3d94f6');
            visualizePlayer(btnHardOvr, hard, 'Hard courts, overall', '#3d94f6');
            visualizePlayer(btnHardYear, hardyear, 'Hard courts, 2020 year', '#3d94f6');
            visualizePlayer(btnHardCur, hardcur, 'Hard courts, after lockdown', '#3d94f6');
            visualizePlayer(btnClayMain, clay, 'Clay courts, overall', '#f4b811');
            visualizePlayer(btnClayOvr, clay, 'Clay courts, overall', '#f4b811');
            visualizePlayer(btnClayYear, clayyear, 'Clay courts, 2020 year', '#f4b811');
            visualizePlayer(btnClayCur, claycur, 'Clay courts, after lockdown', '#f4b811');

            // playersLiClick = document.querySelectorAll('.compare-option');
            // playersLiClick.forEach(function(player) {
            //     comparePlayer(player);
            // });           
            comparePlayer(); 

        </script> -->

        <script type="text/javascript">

            let ovr = {{ ovr|safe }};
            let ovryear = {{ ovryear|safe }};
            let ovrcur = {{ ovrcur|safe }};
            let clay = {{ clay|safe }};
            let clayyear = {{ clayyear|safe }};
            let claycur = {{ claycur|safe }};
            let hard = {{ hard|safe }};
            let hardyear = {{ hardyear|safe }};
            let hardcur = {{ hardcur|safe }};

            let suretyPerc = ({{ player.Surety_won }} / {{ player.Surety_played }} * 100).toFixed(1);
            let favPerc = ({{ player.Favorite_won }} / {{ player.Favorite_played }} * 100).toFixed(1);
            let sliFavPerc = ({{ player.Slightfav_won }} / {{ player.Slightfav_played }} * 100).toFixed(1);
            let contPerc = ({{ player.Slightunder_won }} / {{ player.Slightunder_played }} * 100).toFixed(1);
            let outPerc = ({{ player.Under_won }} / {{ player.Under_played }} * 100).toFixed(1);
            let undPerc = ({{ player.Underdog_won }} / {{ player.Underdog_played }} * 100).toFixed(1);

            let playerName = '{{ player.Name }}';
            let playerID = '{{ player.id }}';
            let playerFirstSrvAcc = '{{ player.First_serve_accuracy|floatformat:"1" }}';
            let playerFirstSrvPts = '{{ player.First_serve_points|floatformat:"1" }}';
            let playerSecSrvPts = '{{ player.Second_serve_points|floatformat:"1" }}';
            let playerBpsSaved = '{{ player.Breakpoints_saved_ratio|floatformat:"1" }}';

            let playerAces = '{{ player.Aces_AVG|floatformat:"1" }}';
            let playerDFs = '{{ player.DoubleFaults_AVG|floatformat:"1" }}';
            let playerBPdef = '{{ player.Breakpoints_to_defend_per_set|floatformat:"1" }}'; 
            let playerBPcre = '{{ player.Breakpoints_created_per_set|floatformat:"1" }}';

            let playerTbWonPerc = '{{ player.Tiebreak_won_perc|floatformat:"1" }}'; 
            let playerFirstRetPts = '{{ player.Return_1st_serve_points|floatformat:"1" }}'; 
            let playerSecRetPts = '{{ player.Return_2nd_serve_points|floatformat:"1" }}'; 
            let playerBpsConv = '{{ player.Breakpoints_converted_ratio|floatformat:"1" }}';

            let playerSrvGames = '{{ player.Service_games_won_ratio|floatformat:"1" }}'
            let playerRetGames = '{{ player.Return_games_won_ratio|floatformat:"1" }}'


        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <link href="{% static 'pyBreak/css/players.css' %}" rel="stylesheet" type="text/css">

    </body>
    <script src="{% static 'pyBreak/js/players.js' %}"></script>
</html>